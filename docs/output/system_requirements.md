# システム要件定義書

## システム概要
本システムは、日本文化（アニメ、漫画、歴史など）に関心がある訪日外国人観光客を対象とした、**"Visual First, Auto Route"**（ビジュアル重視・ルート自動生成）をコンセプトとする聖地巡礼SNSアプリです。

既存の文字情報中心のガイドや、場所の特定が難しいSNSの課題を解決するため、**「直感的に写真で選び、迷わず行ける」**体験を提供します。ユーザーは魅力的な写真から行き先を決め、実際にその場所を訪れるためのルート情報を取得できます。また、旅行中に撮影した写真を投稿することで、自動的に巡礼ルートが生成され、他のユーザーと共有することが可能です。

1. **システムの目的**
   - **解決する具体的な課題**: 訪日外国人が抱える「言葉の壁による情報収集の難しさ」「土地勘のなさによる移動の不安」「具体的にどこに行けばいいかわからない」という課題を、ビジュアルとテクノロジーで解決する。
   - **目標とする成果**: ユーザーが直感的に聖地を見つけ、迷わず訪れ、その体験を簡単に共有できるサイクルの確立。
   - **期待されるビジネスインパクト**: インバウンド観光客の満足度向上、聖地周辺への送客効果（将来的）、日本文化ファンのコミュニティ形成。

2. **主な機能**
   - **コア機能**:
     - **Visual Exploration**: Instagram/Pinterestライクな写真中心の聖地探索（タイムライン/グリッド切替）。
     - **Route Detail**: 写真に紐づく正確なスポット情報と、移動順序を含むルート表示。
     - **Auto Route Posting**: 写真のExif情報（位置情報・日時）を解析し、聖地DBと照合して自動でルートを生成・投稿する機能。
   - **差別化機能**:
     - **Seichi DB Matching**: ユーザーの投稿写真と、正確な位置情報を持つ「聖地DB」を自動で紐付けるロジック。
     - **Contextual Navigation**: 単なる地図アプリへのリンクだけでなく、「どのシーンがどこにあるか」を文脈付きで案内。
   - **付加価値機能**:
     - **My Route Log**: 自分の旅の記録を自動で美しく可視化・保存。

3. **提供する価値**
   - **ユーザー**: 「行きたい」が見つかり、「どう行くか」が瞬時にわかる。旅の記録が手軽に残せる。
   - **ビジネス**: 高品質な聖地データとユーザー行動データの蓄積。
   - **社会的**: 観光客の分散化（マイナーな聖地への誘導）、地方創生への寄与。

4. **実現方法の概要**
   - **モバイルファースト**: 旅行中の利用を前提としたモバイルアプリ（PWAまたはネイティブ）。
   - **画像処理**: 大量の画像を高速に配信するためのCDNと最適化。
   - **地理空間情報**: PostGIS等を用いた位置情報検索とルート計算。

## 情報の前提と仮定
- **分析情報源**: `/docs/input/` 内の全ファイル（business-requirements.md, product-requirements.md, user-personas.md, user-flows.md, feature-list.md, mvp-scope.md, ui-ux-direction.md）。
- **仮定**:
  - **聖地DBの構築**: 初期データとして、主要なアニメ・歴史スポットの正確な緯度経度・メタデータが運営側で用意できることを前提とする。
  - **位置情報の精度**: ユーザーが撮影する写真には、十分な精度でExif位置情報が付与されていることを前提とする。
  - **API利用**: Google Maps API等の地図サービスを利用可能とする。

## 機能要件

### 1. 閲覧・探索機能 (Visual Exploration)
- **タイムライン表示**: 画面幅いっぱいのカード型UIで、写真と簡易ルートマップを縦スクロールで閲覧できること。
- **グリッド表示**: Pinterest風のタイル状レイアウトで、多数の写真を一覧表示し、タップで詳細へ遷移できること。
- **表示切替**: タイムラインとグリッドをワンタップで切り替えられること。
- **詳細画面**: 選択した写真の聖地詳細（作品名、スポット名、説明）と、そこに至るルート（移動順序）を表示すること。
- **保存機能**: 気に入った聖地やルートを「行きたいリスト」に保存できること。

### 2. 投稿・ルート生成機能 (Auto Route Generation)
- **写真選択**: カメラロールから複数枚の写真を一括選択できること。
- **Exif解析・DB照合**:
  - 選択された写真のExif情報（撮影日時、緯度経度）を抽出すること。
  - 抽出した緯度経度を用いて、バックエンドの「聖地DB」から近傍のスポットを検索・特定すること。
  - 日時情報に基づいてスポットを時系列に並べ替え、移動ルートを自動生成すること。
- **手動修正**: 自動判定されたスポットが誤っている場合、ユーザーが検索して正しいスポットに修正できること。
- **投稿公開**: タイトルとコメント（任意）を付与して公開できること。

### 3. アカウント・管理機能
- **認証**: Clerkを用いたメールアドレス、またはソーシャルログイン（Google, Apple）での登録・ログイン。
- **マイページ**: 自分の投稿履歴、保存したルートの一覧表示。
- **聖地DB管理（管理者向け）**: 聖地スポット情報（名称、緯度経度、作品名、代表画像）のCRUD機能。

## 非機能要件
- **パフォーマンス**:
  - 画像の読み込みはCDNを利用し、遅延読み込み（Lazy Loading）等を実装して、ファーストビューの表示を1.5秒以内（4G環境）に抑える。
  - 聖地DB検索（位置情報クエリ）のレスポンスは500ms以内を目指す。
- **スケーラビリティ**:
  - 初期ユーザー数1,000人〜10,000人を想定。画像ストレージとDBの容量拡張性を考慮する。
- **可用性**:
  - 99.9%の稼働率を目標とする。
- **セキュリティ**:
  - 写真の位置情報（プライバシーに関わる自宅付近など）は、投稿時に聖地スポット以外はマスクするか、意図的に削除する処理を検討（MVPでは聖地DBにマッチしたもののみを扱うことでリスク低減）。
  - ユーザーデータの保護、HTTPS通信の強制。
- **対応言語**: 英語（English）のみ。UI文言は全て英語で統一。

## 技術スタック

推奨されるモダンな技術スタックを採用し、開発効率とパフォーマンスを両立させます。

- **フロントエンド**: **Next.js 16+ (React)**
  - 選定理由: PWAとしての実装が容易で、SSR/SSGによる初期表示パフォーマンスが高いため。また、リッチなUIライブラリのエコシステムが充実している。
- **言語**: **TypeScript**
  - 選定理由: 型安全性による開発効率と保守性の向上。
- **バックエンド**: **Next.js App Router (Server Actions)**
  - 選定理由: フロントエンドとバックエンドを単一のコードベースで管理でき、開発速度が速い。小規模〜中規模チームに最適。
- **データベース**: **Supabase (PostgreSQL + PostGIS)**
  - 選定理由: 位置情報検索（GEOクエリ）に強いPostGISが標準で使えるため、聖地検索に最適。画像ストレージ（Supabase Storage）や認証との統合も容易。
- **認証**: **Clerk**
  - 選定理由: 認証フローの実装工数を大幅に削減でき、ソーシャルログインやユーザー管理が容易なため。
- **ホスティング**: **Vercel**
  - 選定理由: Next.jsとの親和性が最も高く、デプロイやエッジ機能（画像最適化など）が容易に利用できるため。
- **地図**: **Google Maps API** (または Mapbox)
  - 選定理由: グローバルでの信頼性とデータの正確性。

## 開発ロードマップ

### Phase 1: MVP開発 (1.5ヶ月)
- **目的**: コア体験（写真閲覧→行く、写真投稿→ルート化）の検証。
- **実装機能**:
  - 聖地DB構築（主要エリア・作品のみ）
  - 閲覧機能（タイムライン/グリッド）
  - 簡易投稿機能（Exif解析・自動マッピング）
  - 認証・マイページ

### Phase 2: 機能拡充 & UX改善 (1.5ヶ月)
- **目的**: ユーザビリティの向上とリテンション強化。
- **実装機能**:
  - 検索・フィルタ機能の強化
  - 地図機能の強化（現在地周辺の検索など）
  - 手動ルート作成・修正機能のUX改善

### Phase 3: コミュニティ & スケール (3ヶ月〜)
- **目的**: ユーザー間交流の促進とコンテンツ拡充。
- **実装機能**:
  - コメント、Q&A機能
  - ユーザーによるスポット提案機能
  - 多言語対応

## リスク分析

1. **コンテンツ（データ）リスク**
   - **リスク**: 初期段階で投稿写真やルートが少なく、アプリが過疎に見える。
   - **対策**: ローンチ前に運営側または委託によって質の高い初期コンテンツ（「公式ルート」的なもの）を100件程度用意する。

2. **技術的リスク**
   - **リスク**: ユーザーがアップロードした写真にExif情報がない（SNS経由で保存した画像など）場合、自動ルート生成が動かない。
   - **対策**: 位置情報がない画像の場合は、手動でスポット検索・紐付けを行うUIを実装する（MVPでは「撮影日時の特定」だけ行い、場所は手動選択させるなどのフォールバックを用意）。

3. **法的・コンプライアンスリスク**
   - **リスク**: アニメのキャプチャ画像の無断利用（著作権侵害）。
   - **対策**: ユーザーには「自分で撮影した現地の写真」の投稿を促す。公式画像の利用は行わず、もし比較画像機能を実装する場合は権利処理済みのものか、引用の範囲内で行うよう厳格に管理する（今回は現地写真メインのためリスクは低め）。

## UI/UXの方向性
- **デザインコンセプト**: **"Immersive Japan"**
  - 没入感を重視し、UIパーツは極力目立たせず、写真が主役となるデザイン。
- **トーン＆マナー**:
  - **Clean & Vibrant**: 白/黒のミニマルなベースに、アクセントカラー「Japan Red」を効かせ、日本の伝統とモダンさを融合させた雰囲気。
- **ターゲットデバイス**:
  - **Mobile First**: スマートフォンでの操作（親指でのスクロール、タップ）に最適化。Web版もモバイルビューを基本とする。
- **参考アプリ**:
  - Instagram (没入感のあるフィード)
  - Zenly (地図とエンタメの融合)
  - YAMAP (ルート表示のUI)

## 追加情報リクエスト
より詳細な設計のために、以下の情報が必要です（優先度順）。

1. **[高] 初期コンテンツの調達計画**: 開発中のテストデータおよびローンチ時の初期データとして、具体的にどの作品・エリアの写真とスポット情報を用意できるか？
2. **[中] 聖地スポットのデータ定義**: 「聖地」として登録する情報の粒度（例：「秋葉原駅」なのか「秋葉原駅 電気街口 階段前」なのか）。詳細すぎるとマッチングが難しく、広すぎるとナビにならない。
3. **[低] 地図APIの予算**: Google Maps APIは従量課金のため、想定PV数に応じた予算感。
